javascript:(function() {
    var doc = document;
    if (window.frames.length > 0) doc = window.main.document;

    // Configuração inicial padrão
    var config = {
        barracks: { tropas: { spear: 10, sword: 5, axe: 0 }, limites: { spear: 50, sword: 30, axe: 20 } },
        stable: { tropas: { light: 5, heavy: 2, scout: 10 }, limites: { light: 20, heavy: 10, scout: 50 } },
        garage: { tropas: { ram: 2, catapult: 1 }, limites: { ram: 10, catapult: 5 } }
    };

    // Função para obter a quantidade atual de tropas
    function getCurrentTroops() {
        var troops = {};
        var spans = doc.getElementsByTagName("span");
        for (var i = 0; i < spans.length; i++) {
            var id = spans[i].id;
            if (id && id.match(/units_entry_all_/)) {
                var troopType = id.replace("units_entry_all_", "");
                var count = parseInt(spans[i].innerText.replace(/[()]/g, "")) || 0;
                troops[troopType] = count;
            }
        }
        return troops;
    }

    // Função para criar o painel de configurações
    function createConfigPanel() {
        // Remove painel existente, se houver
        var existingPanel = doc.getElementById("recruitConfigPanel");
        if (existingPanel) existingPanel.remove();

        // Cria o painel
        var panel = doc.createElement("div");
        panel.id = "recruitConfigPanel";
        panel.style.cssText = `
            position: fixed; top: 20%; left: 50%; transform: translateX(-50%);
            background: #f4e4bc; border: 2px solid #804000; padding: 10px;
            z-index: 1000; font-family: Verdana, Arial, sans-serif; font-size: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); width: 400px;
        `;

        // Título do painel
        var title = doc.createElement("h2");
        title.innerText = "Configurar Recrutamento";
        title.style.cssText = "margin: 0 0 10px; font-size: 14px; color: #804000; text-align: center;";
        panel.appendChild(title);

        // Conteúdo do painel
        var screen = getCurrentScreen();
        if (!screen) {
            alert("Abra o Quartel, Estábulo ou Oficina primeiro!");
            return;
        }

        var section = config[screen];
        var content = doc.createElement("div");
        for (var troop in section.tropas) {
            var div = doc.createElement("div");
            div.style.cssText = "margin-bottom: 8px;";

            var label = doc.createElement("span");
            label.innerText = troop.charAt(0).toUpperCase() + troop.slice(1) + ": ";
            label.style.cssText = "width: 100px; display: inline-block;";
            div.appendChild(label);

            var inputTroops = doc.createElement("input");
            inputTroops.type = "number";
            inputTroops.min = "0";
            inputTroops.value = section.tropas[troop];
            inputTroops.dataset.troop = troop;
            inputTroops.dataset.type = "tropas";
            inputTroops.style.cssText = "width: 60px; margin-right: 10px;";
            div.appendChild(inputTroops);

            var inputLimit = doc.createElement("input");
            inputLimit.type = "number";
            inputLimit.min = "0";
            inputLimit.value = section.limites[troop];
            inputLimit.dataset.troop = troop;
            inputLimit.dataset.type = "limites";
            inputLimit.style.cssText = "width: 60px;";
            div.appendChild(inputLimit);

            content.appendChild(div);
        }
        panel.appendChild(content);

        // Botões
        var buttonDiv = doc.createElement("div");
        buttonDiv.style.cssText = "text-align: center; margin-top: 10px;";

        var saveButton = doc.createElement("button");
        saveButton.innerText = "Salvar e Recrutar";
        saveButton.style.cssText = "background: #d4a373; border: 1px solid #804000; padding: 5px 10px; cursor: pointer;";
        saveButton.onclick = function() {
            updateConfigFromPanel(panel, screen);
            fillRecruitmentFields(screen);
            panel.remove();
        };
        buttonDiv.appendChild(saveButton);

        var closeButton = doc.createElement("button");
        closeButton.innerText = "Fechar";
        closeButton.style.cssText = "background: #d4a373; border: 1px solid #804000; padding: 5px 10px; cursor: pointer; margin-left: 10px;";
        closeButton.onclick = function() { panel.remove(); };
        buttonDiv.appendChild(closeButton);

        panel.appendChild(buttonDiv);
        doc.body.appendChild(panel);
    }

    // Função para atualizar a configuração a partir do painel
    function updateConfigFromPanel(panel, screen) {
        var inputs = panel.getElementsByTagName("input");
        for (var i = 0; i < inputs.length; i++) {
            var troop = inputs[i].dataset.troop;
            var type = inputs[i].dataset.type;
            config[screen][type][troop] = parseInt(inputs[i].value) || 0;
        }
    }

    // Função para identificar a tela atual
    function getCurrentScreen() {
        if (location.href.indexOf("screen=barracks") != -1) return "barracks";
        if (location.href.indexOf("screen=stable") != -1) return "stable";
        if (location.href.indexOf("screen=garage") != -1) return "garage";
        return null;
    }

    // Função para preencher os campos de recrutamento
    function fillRecruitmentFields(screen) {
        var currentTroops = getCurrentTroops();
        var tropas = config[screen].tropas;
        var limites = config[screen].limites;

        for (var troop in tropas) {
            if (doc.forms[0][troop]) {
                var current = currentTroops[troop] || 0;
                var limite = limites[troop] || Infinity;
                var aRecrutar = tropas[troop];

                if (current < limite) {
                    var espacoRestante = limite - current;
                    doc.forms[0][troop].value = Math.min(aRecrutar, espacoRestante);
                } else {
                    doc.forms[0][troop].value = 0;
                }
            }
        }
        alert("Campos preenchidos! Confirme manualmente.");
    }

    // Executa o script: abre o painel de configuração
    createConfigPanel();
})();
